{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block content %}

<div class="container">
<div class="row">
  <!-- 지도 -->
  <div class="col-sm-3">
    <div class="card my-5">
      <div class="card-body d-flex flex-column align-items-center">
        <div id="map" style="width:300px;height:300px;"></div>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=08f364617d32600c522f4000c8d39be8"></script>
        <script>
          var container = document.getElementById('map');
          var options = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 3
          };
          var map = new kakao.maps.Map(container, options);
        </script>
        {% comment %} <script type="text/javascript" src="/static/js/mapscript.js"></script> {% endcomment %}
      </div>
      <a href="#" class="ms-3 text-decoration-none text-dark">
        <p class="mb-1 fw-bold">'{{ article.location }}'</p>
        <p class="mb-3">맛집 더 찾아보기 <i class="bi bi-arrow-right-circle-fill ms-2 text-secondary" ></i></p>
      </a>
    </div>
  </div>

  <!-- 게시글 -->
  <div class="col-sm-9">
    <div class="container d-flex flex-column justify-content-center mt-5 mb-3 p-5 rounded-4 shadow">
      <div class="d-flex justify-content-between align-middle align-items-end">
        <h2 class="fs-1 text-center">
          <span class="fw-bold">
            {{ article.title }}
          </span>
          <span class="fs-3 text-muted">
            | {{ article.location }}
          </span>
        </h2>
        <p class="mb-0 fs-5 text-muted">{{ article.foodType }}</p>
      </div>
      <hr class="mt-1 mb-2">
      <div class="d-flex justify-content-between align-items-center text-muted px-1">
        <!-- 평점 -->
        {% if article.grade == 1 %}
        <div>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
        </div>
        {% elif article.grade == 2 %}
        <div>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
        </div>
        {% elif article.grade == 3 %}
        <div>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
        </div>
        {% elif article.grade == 4 %}
        <div>
          <i class="p-0 bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star fs-4 text-warning"></i>
        </div>
        {% elif article.grade == 5 %}
        <div>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
          <i class="p-0  bi bi-star-fill fs-4 text-warning"></i>
        </div>
        {% endif %}
        <div class="text-end">
        <p class="m-0">작성자 : <a href="{% url 'accounts:profile' article.user.username %}" class="text-decoration-none text-dark">
          <span class="nav1-text">
            {{ article.user.username }}
          </span>
        </a></p>
        {% if article.created_at == article.updated_at %}
          <p class="m-0">{{ article.created_at|date:'Y-m-d D' }}</p>
        {% else %}
          <p class="m-0">{{ article.updated_at|date:'Y-m-d D' }}
            (수정됨)</p>
        {% endif %}
      </div>
      </div>
      <hr class="mt-2">
      {% if article.image %}
        <div class="d-flex justify-content-center">
          <img src="{{ article.image.url }}" class="container">
        </div>
      {% endif %}
      <p class="fs-6 mt-3 mb-5 px-3">{{ article.content}}</p>
      <hr>
      <!-- 아이콘 -->
      <div class="d-flex align-items-center">     
        
        <!-- 좋아요 -->
        <!-- 좋아요 개수 추가하기!!! -->
        <div class="me-3">
          <a class="p-0 m-0 btn btn-lg border-0" href="{% url 'articles:likes' article.pk %}">
            {% if request.user in article.likes_users.all %}
            <i class="bi bi-heart-fill fs-4" style="color: #f38524;"></i>
            {% else %}
            <i class="bi bi-heart fs-4"></i>
            {% endif %}
          </a>
          {% comment %} <p>{{ article.likes_users.count }}</p> {% endcomment %}
        </div>
        <!-- 공유 -->
        <a class="p-0 btn btn-lg border-0 bi bi-share me-3 fs-4" href="#"></a>
        <!-- 스크랩 -->
        {% if request.user in article.likes_users.all %}
        <!-- 스크랩한 유저로 변경해야함!!!!! -->
        <a class="p-0 m-0 btn btn-lg border-0 bi bi-bookmark-fill fs-4" style="color: #ea449a;" href="#"></a>
        {% else %}
        <a class="p-0 m-0 btn btn-lg border-0 bi bi-bookmark fs-4" href="#"></a>
        {% endif %}
      </div>
    </div>
  
    <div class="d-flex justify-content-end">
    {% if request.user == article.user %}
    <div>
      <a class="btn btn-orange m-2 rounded-pill" href="{% url 'articles:update' article.pk %}">수정</a>
      <a class="btn btn-outline-secondary m-2 rounded-pill" href="{% url 'articles:index' %}">뒤로</a>
      <a class="btn btn-pink m-2 rounded-pill" href="{% url 'articles:delete' article.pk %}">삭제</a>
    </div>
    {% else %}
    <a class="btn btn-outline-secondary m-2" href="{% url 'articles:index' %}">뒤로</a>
    {% endif %}
  </div>

  <!-- 댓글 -->
  <div class="mt-3 mb-5 p-5 rounded-4 shadow">
    <div class="d-flex justify-content-between align-items-end mb-4">
      <div class="flex-fill me-2">
        <form action="{% url 'articles:comment_create' article.pk %}" method="POST">
        {% csrf_token %}
          {% bootstrap_form comment_form %}
        </form>
      </div>
      <div class="mb-3">
        <input class="btn btn-search" type="submit" value="작성">
      </div>
    </div>
    <h5 class="">{{ comments|length }}개의 댓글</h5>
    <hr class="mb-0">
    <ul class="list-group list-group-flush rounded-2">
      {% for comment in comments %}
        <li class="list-group-item align-middle">
          <div class="d-flex justify-content-between align-items-center">
            <p class="card-text text-muted m-2">{{ comment.user }}</p>
            <p class="card-text text-muted pt-3">{{ comment.created_at|date:'Y-m-d D' }}</p>
          </div>
          <div class="d-flex justify-content-between align-items-center m-2">
            <p class="">
              {{ comment.content }}
            </p>
            {% if request.user == comment.user %}
            <a href="{% url 'articles:comment_delete' article.pk comment.pk %}" class="text-danger text-decoration-none">
              <i class="bi bi-x-square"></i>
            </a>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</div> <!-- row -->
</div> <!-- container -->

{% endblock content %}